# Anagolay Network Node

Anagolay is a next-generation framework for ownerships, copyrights and digital licenses. ðŸš€

## Local Development

The installation assumes your development environment is a [devcontainer](https://code.visualstudio.com/docs/remote/containers).
For your convenience we provide the settings, recommended extensions and devcontainer. Feel free to use it and report any issues you face.

You'll need to provide a `.env` file in the root of the project that will be used to initialize the container environment.
It can be copied and edited from the provided `sample.env`.

### Testing, building and available commands

We are using the [makers](https://github.com/sagiegurari/cargo-make) crate to automate scripts and make them easier to maintain and execute. All scripts are semantically named and `makers` top level commands are the same.

Here is the list of currently available tasks `makers --list-category-steps anagolay` which you can run by `makers TASK_NAME`.

## Security and code quality

To create the Anagolay node you need to have latest version of the base image `anagolay/rust-ci` which you can get it from [DockerHub](https://hub.docker.com/r/anagolay/rust-ci)

Scanning for the vulnerabilities using builtin [Docker scan](https://docs.docker.com/engine/scan/):

```sh
docker scan --file Dockerfile --exclude-base anagolay/node:0.2.1-dev
```

Audit the code using the [Cargo Audit](https://github.com/RustSec/cargo-audit):

```sh
# check the security
cargo audit
```

Build Code coverage:

```sh
cargo tarpaulin --output-dir coverage --out html
```

Trivy docker conatiner scaning

```sh
docker pull aquasec/trivy:0.16.0
docker run --rm -v /tmp/trivy/:/root/.cache/ aquasec/trivy:0.16.0  anagolay/node:0.2.1-dev
```

## Creating the docker images

Building the Rust-CI base image. This image is used as a CI image on gitlab and as a base builder image for the anagolay node. To change the version edit the `.env` file variable `RUST_IMAGE_VERSION`.

This is quite big image :

```bash
anagolay/rust-ci       0.1.0                9724ca9f4474   3 minutes ago    3.09GB
anagolay/rust-ci       latest               9724ca9f4474   3 minutes ago    3.09GB
```

TODO: pick up the correct version from [`runtime/Cargo.toml`](./runtime/Cargo.toml)

```bash
docker-compose -f rust-ci-docker-compose.yml build
docker-compose -f rust-ci-docker-compose.yml push
```

To build the Anagolay Node you should:

1.  have the latest base image
2.  change the correct version in `.env` file
3.  run the script

```bash
# build it
docker-compose build node

# push it
docker-compose push node
```

## Running in dev mode

```bash
makers chain-dev-start
```

## Testing

To test the full suite run `makers test`
To test documentation examples, run `makers test --doc -- --show-output`

## Benchmarking

To generate pallet weights run from the root of the project. Use the folder name for the pallet. This script will compile the node for you and run the benchmarks.

```sh
# TEMPLATE  ./scripts/run-benchmarks.sh CHAIN PALLET $RUN_WITH_BUILD[true << default |false]

# PoE
./scripts/run-benchmarks.sh dev poe false # this will not build it it will only run it

# Rules
./scripts/run-benchmarks.sh dev rules # this will build it and run it

# Operations
./scripts/run-benchmarks.sh dev operations


# All pallets and all extrinsics with the release build
./scripts/run-all-benchmarks.sh dev

# All pallets and all extrinsics without the release build
./scripts/run-all-benchmarks.sh dev false

```
## Documentation

Cargo has integration with rustdoc to make it easier to generate docs. To generate pallets/crates documentation run from the root of the project. It'll generate all pallet's documentation.

```sh
makers docs-flow --no-deps
```

`docs/api` folder will contain the autogenerated docs in the root of the project. 

VERY important website to check when upgrading the toolchain https://rust-lang.github.io/rustup-components-history/


## License

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
